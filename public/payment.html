<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment Page</title>
</head>
<body>
<h2>Payment Form</h2>
<form id="paymentForm">
  <input type="text" id="name" placeholder="Full Name" required><br><br>
  <input type="email" id="email" placeholder="Email" required><br><br>
  <input type="text" id="phone" placeholder="Phone Number" required><br><br>
  <input type="number" id="amount" placeholder="Amount" required><br><br>
  <button type="submit">Pay Now</button>
</form>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
document.getElementById("paymentForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const data = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    phone: document.getElementById("phone").value,
    amount: parseFloat(document.getElementById("amount").value)
  };

  try {
    const res = await fetch("/create-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const { orderId, key } = await res.json();

    const options = {
      key: key,
      amount: data.amount * 100,
      currency: "INR",
      name: "Training Fees",
      description: "Masterclass Payment",
      order_id: orderId,
      handler: async function(response) {
        await fetch("/verify-payment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            orderId: response.razorpay_order_id,
            paymentId: response.razorpay_payment_id,
            status: "SUCCESS"
          })
        });
        alert("Payment Successful!");
      },
      prefill: { name: data.name, email: data.email, contact: data.phone },
      theme: { color: "#3399cc" }
    };

    const rzp = new Razorpay(options);
    rzp.open();
  } catch (err) {
    console.error(err);
    alert("Something went wrong!");
  }
});
</script>
</body>
</html>
